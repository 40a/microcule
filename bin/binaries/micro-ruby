#!/usr/bin/env ruby

require 'json'

code = ARGV[1]

_env = JSON.parse(ARGV[3])

# assign hook enviroment to Hook variables ( contains params / env / etc )
Hook = _env

# map Hook.env variables to ENV ruby scope ( for convenience )
_env['env'].each do |k, v|
  ENV[k] = v
end

# TODO: do something with service
service = ARGV[5]

# TODO: better error checking around eval
eval code